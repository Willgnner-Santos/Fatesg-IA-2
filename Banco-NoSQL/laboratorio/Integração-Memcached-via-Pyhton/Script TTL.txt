import memcache
import time

# --- Configuração ---
# O cliente se conecta ao servidor Memcached rodando em 'localhost' na porta 11211.
# Se você alterou a porta no Passo 1.2, use a porta correta aqui.
mc = memcache.Client(['127.0.0.1:11211'], debug=0)
chave_teste = "minha_chave_ttl"
valor_teste = "Valor com Time To Live"
ttl_segundos = 5  # Tempo de vida de 5 segundos

print("--- Teste de Integração Memcached e Python ---")

# 1. Armazena um valor com TTL de 5 segundos
print(f"\n1. Armazenando a chave '{chave_teste}' com TTL de {ttl_segundos} segundos...")
# set(chave, valor, tempo_expiracao)
mc.set(chave_teste, valor_teste, ttl_segundos)

# 2. Lê o valor imediatamente
print("2. Lendo o valor imediatamente (antes da expiração)...")
valor_lido = mc.get(chave_teste)

if valor_lido:
    print(f"   SUCESSO: Valor lido é '{valor_lido.decode()}'") # .decode() é necessário se a biblioteca retorna bytes
else:
    print("   ERRO: Valor não encontrado!")

# 3. Aguarda 6 segundos para simular a expiração (TTL: 5 segundos)
tempo_espera = ttl_segundos + 1
print(f"\n3. Aguardando {tempo_espera} segundos para simular a expiração...")
time.sleep(tempo_espera)

# 4. Verifica se o valor foi removido automaticamente
print("4. Verificando se o valor foi removido automaticamente (após a expiração)...")
valor_expirado = mc.get(chave_teste)

if valor_expirado is None:
    print("   SUCESSO: O valor foi removido (expirou) como esperado!")
else:
    print(f"   ERRO: O valor AINDA está presente: '{valor_expirado.decode()}'")

print("\n--- Fim do Teste ---")